import{d as B,X as L,B as v,o as w,c as F,l as V,r as q,k as J,a as X,t as z,v as G,_ as H,P as C,g as d,s as S,a6 as Z,a7 as g,M as K,a8 as Q,m as y}from"./index-QCYlmAW5.js";const W={key:0,class:"ui-button__icon"},Y={class:"ui-button__txt"},ee=B({__name:"UIButton",props:{type:{default:"primary"},text:{default:"Default"}},emits:["click"],setup(t,{emit:e}){const n=t,s=e,r=L(),c=()=>s("click"),u=v(()=>({[`is-${n.type}`]:!0}));return(l,f)=>(w(),F("button",{type:"button",class:G(["ui-button",u.value]),onClick:c},[V(r).default?(w(),F("span",W,[q(l.$slots,"default",{},void 0,!0)])):J("",!0),X("span",Y,z(n.text),1)],2))}}),fe=H(ee,[["__scopeId","data-v-9f608bcd"]]),_="https://my-json-server.typicode.com/Ex-Zy/fb-fake-api",te=`${_}/currentUser`,p=`${_}/productRequests`,pe="Most Upvotes",me="Least Upvotes",ye="Most Comments",be="Least Comments",ve=[{id:2,name:"ui",label:"UI"},{id:3,name:"ux",label:"UX"},{id:4,name:"enhancement",label:"Enhancement"},{id:5,name:"bug",label:"Bug"},{id:6,name:"feature",label:"Feature"}];function se(t){return t.reduce((e,n)=>{var r;const s=(((r=n.replies)==null?void 0:r.length)??0)+1;return e+s},0)}function T(t){return t!=null&&typeof t=="object"}function ne(t,e){const n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;for(const r of n){const c=t[r],u=e[r],l=T(c)&&T(u);if(l&&!ne(c,u)||!l&&c!==u)return!1}return!0}function oe(t){return Object.assign({id:Date.now().toString(),upvotes:0,isUpvoted:!1,status:"suggestion"},t)}async function ae(t){const e=oe(t),n={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},s=await fetch(p,n);if(!s.ok)throw new Error(`${s.status} - ${s.statusText}`);return await s.json()}async function re(t){const e=await fetch(`${p}/${t}`,{method:"DELETE"});if(!e.ok)throw new Error(`${e.status} - ${e.statusText}`);return await e.json()}async function b(t){const e=`${p}/${t.id}`,n={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)},s=await fetch(e,n);if(!s.ok)throw new Error(`${s.status} - ${s.statusText}`);return await s.json()}async function ce(t,e){const n=`${p}/${t}`,s={method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},r=await fetch(n,s);if(!r.ok)throw new Error(`${r.status} - ${r.statusText}`);return await r.json()}const $=C("user",()=>{const t=d(!1),e=d(null),n=d({image:"",name:"",username:""});async function s(){t.value=!0;try{return await(await fetch(te)).json()}catch(c){e.value="Failed to load currentUser",console.log(c)}finally{t.value=!1}}async function r(){const c=await s();c&&(n.value=c)}return{loader:t,error:e,currentUser:n,fetchCurrentUser:s,loadCurrentUserToStore:r}});function ue(t){var c;const{feedback:e}=S(U()),{currentUser:n}=$();if(!((c=e.value)!=null&&c.comments))return[];const{comments:s}=e.value,r={id:Date.now().toString(),content:t,user:{...n}};return s?[...s,r]:[r]}function ie(t,e){var c;const{feedback:n}=S(U()),{currentUser:s}=$();if(!((c=n.value)!=null&&c.comments))return[];const{comments:r=[]}=n.value;return r.map(u=>{if(u.id===t){const l={id:Date.now().toString(),content:e,user:{...s},replyingTo:(u==null?void 0:u.user.username)??""};u.replies=u.replies?[...u.replies,l]:[l]}return u})}function le(t,e){const n=Z(t);return n.value.isUpvoted=e,n.value.upvotes++,{...n.value}}const U=C("feedback",()=>{const t=g.useToast(),e=d(!0),n=d(null),s=d(null),r=v(()=>{var a;return((a=s.value)==null?void 0:a.comments)??null}),c=v(()=>r.value?se(r.value):0),u=d([]);function l(a){return u.value.includes(a)}function f(){u.value.length=0}function k(a){u.value.push(a)}function E(a){l(a)?f():(f(),k(a))}async function h(a){e.value=!0;try{return await(await fetch(`${p}/${a}`)).json()}catch(o){n.value="Failed to load feedback",console.log(o)}finally{e.value=!1}}async function O(){const a=K().params.id.toString(),o=await h(a);o&&(s.value=o)}async function R(a,o){try{if(!o)return;const{id:i,upvotes:m}=le(a,o),I=await ce(i,{isUpvoted:o,upvotes:m}),{showConfetti:N}=Q();return await N(),I}catch(i){n.value="Something went wrong",console.log(i)}}function j(){e.value=!0,n.value=null,s.value=null,f()}async function x(a,o){e.value=!0;try{const i=ie(a,o);if(!s.value)return;s.value.comments=i,f();const m=await b(s.value);return m?(t.success("Comment successfully added",{position:"top",duration:3e3}),m):void 0}catch(i){console.log(i),t.error("Failed to create comment",{position:"top",duration:3e3})}finally{e.value=!1}}async function D(a){e.value=!0;try{const o=ue(a);if(!s.value)return;s.value.comments=o;const i=await b(s.value);return i?(t.success("Comment successfully added",{position:"top",duration:3e3}),i):void 0}catch(o){console.log(o),t.error("Failed to create comment",{position:"top",duration:3e3})}finally{e.value=!1}}async function M(a){e.value=!0;try{s.value=a;const o=await b(a);return o?(t.success("Feedback successfully edited",{position:"top",duration:3e3,onDismiss:()=>y.back()}),o):void 0}catch(o){console.log(o),t.error("Failed to edit feedback",{position:"top",duration:3e3})}finally{e.value=!1}}async function P(a){e.value=!0;try{const o=await re(a.id);return o?(t.success("Feedback successfully deleted",{position:"top",duration:3e3,onDismiss:()=>y.push("/")}),o):void 0}catch(o){console.log(o),t.error("Failed to delete feedback",{position:"top",duration:3e3})}finally{e.value=!1}}async function A(a){e.value=!0;try{const o=await ae(a);return o?(g.useToast().success("Feedback successfully created",{position:"top",duration:3e3,onDismiss:()=>y.push("/")}),o):void 0}catch(o){console.log(o),t.error("Failed to create feedback",{position:"top",duration:3e3})}finally{e.value=!1}}return{loader:e,error:n,feedback:s,comments:r,commentsAmount:c,visibleReplies:u,isVisibleReply:l,showReply:k,hideReplies:f,toggleReply:E,fetchFeedback:h,loadFeedbackToStore:O,upvoteFeedback:R,$reset:j,submitReply:x,submitComment:D,editFeedback:M,deleteFeedback:P,createNewFeedback:A}});export{p as A,ve as C,me as L,pe as M,fe as U,ye as a,be as b,$ as c,ne as d,se as e,U as u};
