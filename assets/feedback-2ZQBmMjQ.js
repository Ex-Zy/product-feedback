import{d as D,R as I,m as b,o as T,c as g,h as L,r as B,i as V,a as q,z as J,n as z,_ as X,k as U,l as d,N as G,W as H,X as W,A as h}from"./index-9cmW35FG.js";const E="https://my-json-server.typicode.com/Ex-Zy/fb-fake-api",Z=`${E}/currentUser`,p=`${E}/productRequests`,ce="Most Upvotes",ue="Least Upvotes",le="Most Comments",ie="Least Comments",fe=[{id:2,name:"ui",label:"UI"},{id:3,name:"ux",label:"UX"},{id:4,name:"enhancement",label:"Enhancement"},{id:5,name:"bug",label:"Bug"},{id:6,name:"feature",label:"Feature"}];function K(e){return e.reduce((t,n)=>{var r;const o=(((r=n.replies)==null?void 0:r.length)??0)+1;return t+o},0)}function C(e){return e!=null&&typeof e=="object"}function Q(e,t){const n=Object.keys(e),o=Object.keys(t);if(n.length!==o.length)return!1;for(const r of n){const c=e[r],f=t[r],l=C(c)&&C(f);if(l&&!Q(c,f)||!l&&c!==f)return!1}return!0}const Y={key:0,class:"ui-button__icon"},ee={class:"ui-button__txt"},te=D({__name:"UIButton",props:{type:{default:"primary"},text:{default:"Default"}},emits:["click"],setup(e,{emit:t}){const n=e,o=t,r=I(),c=()=>o("click"),f=b(()=>({[`is-${n.type}`]:!0}));return(l,v)=>(T(),g("button",{type:"button",class:z(["ui-button",f.value]),onClick:c},[L(r).default?(T(),g("span",Y,[B(l.$slots,"default",{},void 0,!0)])):V("",!0),q("span",ee,J(n.text),1)],2))}}),de=X(te,[["__scopeId","data-v-9f608bcd"]]),_=U("user",()=>{const e=d(!1),t=d(null),n=d({image:"",name:"",username:""});async function o(){e.value=!0;try{return await(await fetch(Z)).json()}catch(c){t.value="Failed to load currentUser",console.log(c)}finally{e.value=!1}}async function r(){const c=await o();c&&(n.value=c)}return{loader:e,error:t,currentUser:n,fetchCurrentUser:o,loadCurrentUserToStore:r}});async function ne(e,t){const n=`${p}/${e}`,o={method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)},r=await fetch(n,o);if(!r.ok)throw new Error(`${r.status} - ${r.statusText}`);return await r.json()}async function se(e){const t=await fetch(`${p}/${e}`,{method:"DELETE"});if(!t.ok)throw new Error(`${t.status} - ${t.statusText}`);return await t.json()}async function w(e){const t=`${p}/${e.id}`,n={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},o=await fetch(t,n);if(!o.ok)throw new Error(`${o.status} - ${o.statusText}`);return await o.json()}function ae(e){return Object.assign({id:Date.now(),upvotes:0,isUpvoted:!1,status:"suggestion"},e)}async function oe(e){const t=ae(e),n={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)},o=await fetch(p,n);if(!o.ok)throw new Error(`${o.status} - ${o.statusText}`);return await o.json()}const pe=U("feedback",()=>{const e=d(!0),t=d(null),n=d(null),o=b(()=>{var s;return((s=n.value)==null?void 0:s.comments)??null}),r=b(()=>o.value?K(o.value):0),c=d([]);function f(s){return c.value.includes(s)}function l(){c.value.length=0}function v(s){c.value.push(s)}function $(s){f(s)?l():(l(),v(s))}async function k(s){e.value=!0;try{return await(await fetch(`${p}/${s}`)).json()}catch(a){t.value="Failed to load feedback",console.log(a)}finally{e.value=!1}}async function O(){const s=Number(G().params.id),a=await k(s);a&&(n.value=a)}async function R(s,a){try{const i=H(s);if(!a||!i.value)return;const u=s.upvotes+1;i.value.isUpvoted=a,i.value.upvotes=u;const m=await ne(s.id,{isUpvoted:a,upvotes:u}),{showConfetti:y}=W();return await y(),m}catch(i){t.value="Something went wrong",console.log(i)}}function F(){e.value=!0,t.value=null,n.value=null,l()}async function j(s,a){var y,S;const{currentUser:i}=_(),u=(S=(y=n.value)==null?void 0:y.comments)==null?void 0:S.find(P=>P.id===s);if(!u)return;const m={id:Date.now(),content:a,user:{...i},replyingTo:(u==null?void 0:u.user.username)??""};return u.replies=u.replies?[...u.replies,m]:[m],l(),await w(n.value)}async function x(s){e.value=!0;try{if(!n.value)return;const{currentUser:a}=_(),{comments:i}=n.value,u={id:Date.now(),content:s,user:{...a}};return n.value.comments=i?[...i,u]:[u],await w(n.value)}catch(a){t.value="Something went wrong",console.log(a)}finally{e.value=!1}}async function A(s){e.value=!0;try{return n.value=s,setTimeout(()=>h.back(),100),await w(s)}catch(a){t.value="Something went wrong",console.log(a)}finally{e.value=!1}}async function N(s){e.value=!0;try{const a=await se(s.id);return a?(setTimeout(()=>h.push("/"),100),a):void 0}catch{t.value="Something went wrong"}finally{e.value=!1}}async function M(s){e.value=!0;try{const a=await oe(s);return a?(setTimeout(()=>h.push("/"),100),a):void 0}catch{t.value="Something went wrong"}finally{e.value=!1}}return{loader:e,error:t,feedback:n,comments:o,commentsAmount:r,visibleReplies:c,isVisibleReply:f,showReply:v,hideReplies:l,toggleReply:$,fetchFeedback:k,loadFeedbackToStore:O,upvoteFeedback:R,$reset:F,submitReply:j,submitComment:x,editFeedback:A,deleteFeedback:N,createNewFeedback:M}});export{p as A,fe as C,ue as L,ce as M,de as U,le as a,ie as b,K as c,_ as d,Q as e,pe as u};
