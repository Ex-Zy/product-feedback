import{R,v as c,s as D,B as g,M as $,S as q,U as x}from"./index-dvVLpKp4.js";import{d as A,u as B,c as M,p as N}from"./UIButton-LDYGP6g8.js";const h=R("user",()=>{const l=c(!1),r=c(null),u=c({image:"",name:"",username:""});async function o(i=300){l.value=!0;try{return await new Promise((p,f)=>{setTimeout(p,i,A)})}catch(a){r.value="Failed to load currentUser",console.log(a)}finally{l.value=!1}}async function v(){const i=await o();i&&(u.value=i)}return{loader:l,error:r,currentUser:u,fetchCurrentUser:o,loadCurrentUserToStore:v}}),E=R("feedback",()=>{const{suggestions:l}=D(B()),r=c(!0),u=c(null),o=c(null),v=g(()=>{var e;return((e=o.value)==null?void 0:e.comments)??null}),i=g(()=>v.value?M(v.value):0),a=c([]);function p(e){return a.value.includes(e)}function f(){a.value.length=0}function w(e){a.value.push(e)}function k(e){p(e)?f():(f(),w(e))}async function b(e,s=600){r.value=!0;try{return await new Promise((n,d)=>{const y=N.find(m=>m.id===e);setTimeout(n,s,y)})}catch(t){u.value="Failed to load feedback",console.log(t)}finally{r.value=!1}}async function U(){const e=Number($().params.id),s=await b(e);s&&(o.value=s)}async function F(e,s){const t=q(e);if(!s||!t.value)return;t.value.isUpvoted=s,t.value.upvotes++;const{showConfetti:n}=x();await n()}function S(){r.value=!0,u.value=null,o.value=null,f()}function P(e,s){var d,y;const{currentUser:t}=h(),n=(y=(d=o.value)==null?void 0:d.comments)==null?void 0:y.find(m=>m.id===e);if(n){const m={id:Date.now(),content:s,user:{...t},replyingTo:(n==null?void 0:n.user.username)??""};n.replies=n.replies?[...n.replies,m]:[m],f()}}function T(e){if(!o.value)return;const{currentUser:s}=h(),{comments:t}=o.value,n={id:Date.now(),content:e,user:{...s}};o.value.comments=t?[...t,n]:[n]}async function C(e,s=600){r.value=!0;try{return new Promise((t,n)=>{setTimeout(()=>{o.value=e,t(e)},s)})}catch(t){u.value="Something went wrong",console.log(t)}finally{r.value=!1}}async function j(e,s=600){r.value=!0;try{return new Promise((t,n)=>{setTimeout(()=>{l.value=l.value.filter(d=>d.id!==e.id),t(e)},s)})}catch{u.value="Something went wrong"}finally{r.value=!1}}return{loader:r,error:u,feedback:o,comments:v,commentsAmount:i,visibleReplies:a,isVisibleReply:p,showReply:w,hideReplies:f,toggleReply:k,fetchFeedback:b,loadFeedbackToStore:U,upvoteFeedback:F,$reset:S,submitReply:P,submitComment:T,editFeedback:C,deleteFeedback:j}});export{h as a,E as u};
